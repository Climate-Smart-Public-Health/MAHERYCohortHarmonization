<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preprocessing 2018 Household Heads • MAHERYCohortHarmonization</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preprocessing 2018 Household Heads">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MAHERYCohortHarmonization</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/opensrp-cohort-2018-preprocessing.html">OpenSRP Cohort 2018 Preprocessing</a></li>
    <li><a class="dropdown-item" href="../articles/OutputTables.html">Pipeline Outputs</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing-2018-health-status.html">Preprocessing 2018 Health Status</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing-2018-household-heads.html">Preprocessing 2018 Household Heads</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing-2019-health-status.html">Preprocessing 2019 Health Status</a></li>
    <li><a class="dropdown-item" href="../articles/preprocessing-dharma-2019-cohort.html">Preprocessing Dharma 2019 Cohort</a></li>
    <li><a class="dropdown-item" href="../articles/reporting-with-pins-and-google-drive.html">Reporting with pins and Google Drive</a></li>
    <li><a class="dropdown-item" href="../articles/tracking-input-data.html">Tracking Input Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Preprocessing 2018 Household Heads</h1>
            
      

      <div class="d-none name"><code>preprocessing-2018-household-heads.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MAHERYCohortHarmonization</span><span class="op">)</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/flat_cohort_household_heads.Rmd: do not edit by hand -->
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /net/rcstorenfs02/ifs/rc_labs/dominici_lab/lab/data_processing/csph_MDG-SurveyHarmonization/MAHERYCohortHarmonization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html" class="external-link">tar_load</a></span><span class="op">(</span><span class="va">opensrp</span>, store <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"_targets"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html" class="external-link">tar_load</a></span><span class="op">(</span><span class="va">opensrp_dict</span>, store <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"_targets"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html" class="external-link">tar_load</a></span><span class="op">(</span><span class="va">cohort_2018</span>, store <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"_targets"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load already included functions if relevant</span></span>
<span><span class="fu">pkgload</span><span class="fu">::</span><span class="fu"><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span>export_all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">MAHERYCohortHarmonization</span></span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'janitor'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     chisq.test, fisher.test</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:testthat':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     matches</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:testthat':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     matches</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr/" class="external-link">skimr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'skimr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:testthat':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     matches</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="cohort_household_heads">cohort_household_heads<a class="anchor" aria-label="anchor" href="#cohort_household_heads"></a>
</h2>
<p>In this stage of the pipeline, we’re preprocessing and cleaning the
dataset to generate a record of the heads of households and their
geographic locations. This is important because it allows us to analyze
the data at the household level, which is often more relevant for
understanding social and economic dynamics.</p>
<blockquote>
<p>In Madagascar, as in many countries, the household head (or chef de
ménage) is a key unit of reference in population-level analyses,
especially in surveys, censuses, and administrative datasets. In
Madagascar, household headship can also reflect traditional norms and
ethnic practices, which might influence the structure and function of
households. Extended family households with multiple generations under
one roof are common in some regions, and the definition of “head” may
differ from a purely economic or legal interpretation.</p>
</blockquote>
<p>This is therefore an important component of the data preparation
project.</p>
<div class="section level3">
<h3 id="reading-in-the-data">Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"></a>
</h3>
<p>The data is read in from the targets pipeline, and is contained in
the <code>opensrp</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">opensrp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Follow up"           "Hhregistration edit" "Hhregistration"     </span></span>
<span><span class="co">#&gt; [4] "GPS"                 "Follow up edit"      "Open census"        </span></span>
<span><span class="co">#&gt; [7] "Open census edit"</span></span></code></pre></div>
<p>The specific sheet is called <code>Hhregistration</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg</span> <span class="op">&lt;-</span> <span class="va">opensrp</span><span class="op">$</span><span class="va">Hhregistration</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hhreg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;   `User Id`   Id          Village Province `Sub District` District `Sub Village`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Antaravato1 Dd388725-6… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Antaravato1 Cb2abe56-8… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Antaravato1 6fb7e207-5… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Antaravato1 9f2b71d6-6… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Antaravato1 3165abc9-6… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Antaravato1 A46962c2-c… Antara… Analanj… Antsirabe-sah… Maroant… <span style="color: #BB0000;">NA</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: `Registration Date` &lt;chr&gt;, `Name Household Head` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Hh Gps Point` &lt;lgl&gt;, `Submission Date` &lt;chr&gt;, `Is Closed` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Client Version Submission Date` &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `Server Version Submission Date` &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cleaning-the-data">Cleaning the data<a class="anchor" aria-label="anchor" href="#cleaning-the-data"></a>
</h3>
<p>As in the 2018 cohort prep, we’re going to start by cleaning the
column names:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">hhreg_</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hhreg_</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "user_id"                        "id"                            </span></span>
<span><span class="co">#&gt;  [3] "village"                        "province"                      </span></span>
<span><span class="co">#&gt;  [5] "sub_district"                   "district"                      </span></span>
<span><span class="co">#&gt;  [7] "sub_village"                    "registration_date"             </span></span>
<span><span class="co">#&gt;  [9] "name_household_head"            "hh_gps_point"                  </span></span>
<span><span class="co">#&gt; [11] "submission_date"                "is_closed"                     </span></span>
<span><span class="co">#&gt; [13] "client_version_submission_date" "server_version_submission_date"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html" class="external-link">skim</a></span><span class="op">(</span><span class="va">hhreg_</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">hhreg_</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">138</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">12</td>
</tr>
<tr class="odd">
<td align="left">logical</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table style="width:100%;" class="table">
<colgroup>
<col width="34%">
<col width="11%">
<col width="15%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="10%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">user_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">11</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">32</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">138</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">village</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">province</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">sub_district</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">18</td>
<td align="right">18</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">district</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">registration_date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">27</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">name_household_head</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">26</td>
<td align="right">0</td>
<td align="right">135</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">submission_date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">15</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">is_closed</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">client_version_submission_date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">19</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">136</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">server_version_submission_date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">19</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">125</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sub_village</td>
<td align="right">138</td>
<td align="right">0</td>
<td align="right">NaN</td>
<td align="left">:</td>
</tr>
<tr class="even">
<td align="left">hh_gps_point</td>
<td align="right">138</td>
<td align="right">0</td>
<td align="right">NaN</td>
<td align="left">:</td>
</tr>
</tbody>
</table>
<p>It looks like we will eventually drop the <code>sub_village</code>
and hh_gps_point columns, as they contain only NA values. In any case,
GPS will be handled in a different file.</p>
<p>Is <code>user_id</code> anything useful?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg_</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">user_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 1</span></span></span>
<span><span class="co">#&gt;   user_id    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Antaravato1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Antaravato2</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg_</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">village</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   village   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Antaravato</span></span></code></pre></div>
<p>How does that differ from the province?:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg_</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">province</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   province    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Analanjirofo</span></span></code></pre></div>
<p>Let’s just look at these columns together:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hhreg_</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">user_id</span>, <span class="va">village</span>, <span class="va">sub_village</span>, <span class="va">district</span>, <span class="va">sub_district</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">as_factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         user_id          village    sub_village         district  </span></span>
<span><span class="co">#&gt;  Antaravato1:135   Antaravato:138   FALSE:  0   Maroantsetra:138  </span></span>
<span><span class="co">#&gt;  Antaravato2:  3                    TRUE :  0                     </span></span>
<span><span class="co">#&gt;                                     NA's :138                     </span></span>
<span><span class="co">#&gt;              sub_district</span></span>
<span><span class="co">#&gt;  Antsirabe-sahatany:138  </span></span>
<span><span class="co">#&gt;                          </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>So the only thing that changes is the use of Antaravato 1 and 2.</p>
<p>Are all of the heads in the cohort file represented in this file?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort_2018</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hh_head_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">cohort_2018_hh_head_names</span></span>
<span></span>
<span><span class="va">hhreg_</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hh_head_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_lower</a></span><span class="op">(</span><span class="va">name_household_head</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_lower</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_squish</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">","</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hh_head_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">hhreg_hh_head_names</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">cohort_2018_hh_head_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">hhreg_hh_head_names</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>As long as we follow the same preprocessing of names in the 2018
approach, the names all match.</p>
</div>
<div class="section level3">
<h3 id="adding-geography">Adding Geography<a class="anchor" aria-label="anchor" href="#adding-geography"></a>
</h3>
<p>We’re also going to take care of cleaning the geography in this
step.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hh_geography</span> <span class="op">&lt;-</span> <span class="va">opensrp</span><span class="op">$</span><span class="va">GPS</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hh_geography</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;     `#` `Head of Household` `GPS point`                                Note </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Alexis              -15.477236 49.56519 -19 103.15599822998047 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Arsene              -15.476309 49.565197 34 27.305999755859375 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Avelice             <span style="color: #BB0000;">NA</span>                                         <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Aveline germene     -15.478095 49.565661 -12 71.29900360107422 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Be alphonse         -15.477117 49.565308 40 72.81600189208984  <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                                         <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>There are two notes we’ll have to resolve:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hh_geography</span><span class="op">$</span><span class="va">Note</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA                                                                                                  </span></span>
<span><span class="co">#&gt; [2] "Double check this GPS location it seems that is something for this one."                           </span></span>
<span><span class="co">#&gt; [3] "There are two Eddy in Antaravato so double check with Rivo and Saufiel which Eddy you are talking."</span></span></code></pre></div>
<p>We do notice that there is an Eddy (I) and an Eddy (II) in the
data.</p>
<p>We’ll quickly clean this and join it into the household head
dataframe:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hh_geography</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hh_head_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_lower</a></span><span class="op">(</span><span class="va">head_of_household</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_lower</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_squish</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">"\\("</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">"\\)"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="st">","</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">gps_point</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span>, <span class="st">"altitude"</span>, <span class="st">"accuracy"</span><span class="op">)</span>,</span>
<span>           sep <span class="op">=</span> <span class="st">" "</span>,</span>
<span>           convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>has_gps <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      number       head_of_household     latitude        longitude    </span></span>
<span><span class="co">#&gt;  Min.   :  1.00   Length:136         Min.   :-15.48   Min.   :49.56  </span></span>
<span><span class="co">#&gt;  1st Qu.: 34.75   Class :character   1st Qu.:-15.48   1st Qu.:49.57  </span></span>
<span><span class="co">#&gt;  Median : 68.50   Mode  :character   Median :-15.48   Median :49.57  </span></span>
<span><span class="co">#&gt;  Mean   : 68.50                      Mean   :-15.48   Mean   :49.57  </span></span>
<span><span class="co">#&gt;  3rd Qu.:102.25                      3rd Qu.:-15.48   3rd Qu.:49.57  </span></span>
<span><span class="co">#&gt;  Max.   :136.00                      Max.   :-15.47   Max.   :49.57  </span></span>
<span><span class="co">#&gt;                                      NA's   :75       NA's   :75     </span></span>
<span><span class="co">#&gt;     altitude         accuracy          note           hh_head_name      </span></span>
<span><span class="co">#&gt;  Min.   :-30.00   Min.   : 10.00   Length:136         Length:136        </span></span>
<span><span class="co">#&gt;  1st Qu.: -4.00   1st Qu.: 22.75   Class :character   Class :character  </span></span>
<span><span class="co">#&gt;  Median :  9.00   Median : 30.34   Mode  :character   Mode  :character  </span></span>
<span><span class="co">#&gt;  Mean   : 16.97   Mean   : 44.74                                        </span></span>
<span><span class="co">#&gt;  3rd Qu.: 37.00   3rd Qu.: 68.27                                        </span></span>
<span><span class="co">#&gt;  Max.   : 97.00   Max.   :185.07                                        </span></span>
<span><span class="co">#&gt;  NA's   :75       NA's   :75                                            </span></span>
<span><span class="co">#&gt;   has_gps       </span></span>
<span><span class="co">#&gt;  Mode :logical  </span></span>
<span><span class="co">#&gt;  FALSE:75       </span></span>
<span><span class="co">#&gt;  TRUE :61       </span></span>
<span><span class="co">#&gt;                 </span></span>
<span><span class="co">#&gt;                 </span></span>
<span><span class="co">#&gt;                 </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>This seems to work, however not many households have GPS and there
doesn’t seem to be a lot of information in the latitude and longitude
values. Oh well…</p>
<p>This should suffice for the household head preprocessing. The
function can be seen in action below:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/preprocess_2018_household_heads.html">preprocess_2018_household_heads</a></span><span class="op">(</span><span class="va">opensrp</span>, <span class="va">cohort_2018</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  original_id        hh_head_name       submission_date            village   </span></span>
<span><span class="co">#&gt;  Length:138         Length:138         Min.   :2017-07-25   Antaravato:138  </span></span>
<span><span class="co">#&gt;  Class :character   Class :character   1st Qu.:2017-07-30                   </span></span>
<span><span class="co">#&gt;  Mode  :character   Mode  :character   Median :2017-08-02                   </span></span>
<span><span class="co">#&gt;                                        Mean   :2017-10-17                   </span></span>
<span><span class="co">#&gt;                                        3rd Qu.:2018-01-17                   </span></span>
<span><span class="co">#&gt;                                        Max.   :2018-05-02                   </span></span>
<span><span class="co">#&gt;                                                                             </span></span>
<span><span class="co">#&gt;          province           district    gps_latitude    gps_longitude  </span></span>
<span><span class="co">#&gt;  Analanjirofo:138   Maroantsetra:138   Min.   :-15.48   Min.   :49.56  </span></span>
<span><span class="co">#&gt;                                        1st Qu.:-15.48   1st Qu.:49.57  </span></span>
<span><span class="co">#&gt;                                        Median :-15.48   Median :49.57  </span></span>
<span><span class="co">#&gt;                                        Mean   :-15.48   Mean   :49.57  </span></span>
<span><span class="co">#&gt;                                        3rd Qu.:-15.48   3rd Qu.:49.57  </span></span>
<span><span class="co">#&gt;                                        Max.   :-15.47   Max.   :49.57  </span></span>
<span><span class="co">#&gt;                                        NA's   :80       NA's   :80     </span></span>
<span><span class="co">#&gt;   gps_altitude     gps_accuracy        uuid          </span></span>
<span><span class="co">#&gt;  Min.   :-30.00   Min.   : 10.00   Length:138        </span></span>
<span><span class="co">#&gt;  1st Qu.: -8.00   1st Qu.: 22.75   Class :character  </span></span>
<span><span class="co">#&gt;  Median :  9.00   Median : 31.10   Mode  :character  </span></span>
<span><span class="co">#&gt;  Mean   : 15.12   Mean   : 45.44                     </span></span>
<span><span class="co">#&gt;  3rd Qu.: 32.75   3rd Qu.: 69.40                     </span></span>
<span><span class="co">#&gt;  Max.   : 97.00   Max.   :185.07                     </span></span>
<span><span class="co">#&gt;  NA's   :80       NA's   :80</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tinashe Tapera.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
