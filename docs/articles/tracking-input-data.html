<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tracking Input Data • MAHERYCohortHarmonization</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tracking Input Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MAHERYCohortHarmonization</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/get-started.html">Get started</a>
    </li>
    <li>
      <a href="../articles/tracking-input-data.html">Tracking Input Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tracking Input Data</h1>
                        <h4 data-toc-skip class="author">Tinashe M.
Tapera</h4>
            
      

      <div class="hidden name"><code>tracking-input-data.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MAHERYCohortHarmonization</span><span class="op">)</span></span></code></pre></div>
<!-- WARNING - This vignette is generated by {fusen} from dev/flat_tracking_inputs.Rmd: do not edit by hand -->
<div class="section level2">
<h2 id="tracking-inputs">Tracking Inputs<a class="anchor" aria-label="anchor" href="#tracking-inputs"></a>
</h2>
<p>In this notebook, we’re developing functions to track all of the
input data. Importantly, this data is stored on Google Drive and must
not be shared publicly on the internet, so we will need to use
programmatic credentials to access it.</p>
<p>Let’s first create a function that will log us in to google drive
with the appropriate credentials. For this, we’ll use the
<code>googledrive</code> package from <code>tidyverse</code>.</p>
<p>We can start the process of authorization using the
<code>drive_auth()</code> function. This requires access to the a
special JSON file that contains the credentials for the google drive
account.</p>
<p>To enable non-interactive access to Google Drive from this R package,
we use a <em>Google Cloud service account</em> for authentication. This
allows scripts and functions to interact with Google Drive without
requiring manual sign-in or browser-based authentication. It’s
particularly useful for automated workflows, scheduled tasks, or when
deploying the package in cloud environments (e.g., on a server like
<code>FASRC</code>). The service account acts like a dummy user with its
own credentials, and it can be granted access to specific files or
folders in the CSPH drives. Access to the service account can be
controlled via sharing permissions just like any human Google Drive
user.</p>
<p>To set this up, the service account was created via the Google Cloud
Console under a project with the Google Drive API enabled. A JSON key
was generated and downloaded — this file contains the credentials used
to authenticate in R. Any Google Drive resources the package needs to
access must be explicitly shared with the service account’s email (in
this case,
<code>data-pipeline@harvard-csph-driveauth.iam.gserviceaccount.com</code>).
Once shared, the pipeline uses the <code>googledrive</code> package in R
to authenticate via <code>drive_auth(path = "path/to/key.json")</code>,
allowing Drive operations to run seamlessly.</p>
<p>This authentication method ensures that all users of this package (or
future maintainers) can use a consistent, secured credential file for
Drive access. To maintain this setup, keep the JSON key file in a
protected location, and do not commit it to version control. If the key
ever needs to be regenerated (e.g., due to compromise or rotation), the
same process above can be followed to create a new one.</p>
<div class="section level3">
<h3 id="authenticating-with-google-drive">Authenticating with Google Drive<a class="anchor" aria-label="anchor" href="#authenticating-with-google-drive"></a>
</h3>
<p>If you have the authentication file, you can simply point to it with
your <code>drive_auth()</code> function in an interactive session. If
this is successful, you should be able to access the Google Drive files
from R with <code>drive_find()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_to_auth</span> <span class="op">&lt;-</span> <span class="st">"path/to/your/auth.json"</span></span>
<span><span class="fu">drive_auth</span><span class="op">(</span>path <span class="op">=</span> <span class="va">path_to_auth</span><span class="op">)</span></span>
<span><span class="fu">drive_find</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In a non-interactive session, make sure to set the environment
variable with <code>.Renviron</code>.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A dribble: 27 × 3</span></span></span>
<span><span class="co">#&gt;    name                                                  id       drive_resource</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;drv_id&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> DATA Health Surveillance as of 05/03/2023             1fL0TLB… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> olo_vaovao_na_zaza_teraka_individual_enrollement.xlsx 10tmcsm… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2018                                                  169yRof… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> New household enrolled                                1sN3wOA… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> tokantrano_vaovao_household_enrollement_named.csv     11SmUIo… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> tokantrano_vaovao_household_enrollement_coded.csv     1d5zFz4… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> tokantrano_vaovao_household_enrollement.xlsx          1oYDF0R… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> refy_zaza_sy_tosi_dra_child_status_and_blood_pressur… 1lU_70X… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> refy_zaza_sy_tosi_dra_child_status_and_blood_pressur… 1cyFxmG… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> refy_zaza_sy_tosi_dra_child_status_and_blood_pressur… 1BidCTN… <span style="color: #949494;">&lt;named list&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 17 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/authenticate_google_drive.html">authenticate_google_drive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We can add this to the beginning of our <code>targets</code>
pipeline.</p>
</div>
<div class="section level3">
<h3 id="northeast-data">Northeast Data<a class="anchor" aria-label="anchor" href="#northeast-data"></a>
</h3>
<div class="warning">
<p><strong>Warning:</strong> <italic>DO NOT</italic> use file ID
identifiers in rendered HTML vignettes, as they can be used to access
the Google Drive if sharing is enabled. This is a security risk.
Instead, use the file name and
<code>drive_find(pattern = [REGEX])</code> to reference files.</p>
</div>
<p>Now that we have access to the Google Drive, we can start tracking
the input data. We’ll start with the Northeast data.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tinashe Tapera.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
